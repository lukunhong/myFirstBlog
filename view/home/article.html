<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>lulu的BLOG《<?php echo $art_info['title']; ?>》</title>
  <link rel="stylesheet" type="text/css" href="<?php echo __CSS__;?>/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="<?php echo __CSS__;?>/nprogress.css">
  <link rel="stylesheet" type="text/css" href="<?php echo __CSS__;?>/style.css">
  <link rel="stylesheet" type="text/css" href="<?php echo __CSS__;?>/font-awesome.min.css">
  <link rel="apple-touch-icon-precomposed" href="<?php echo __IMAGES__;?>/icon/icon.png">
  <link rel="shortcut icon" href="<?php echo __IMAGES__;?>/icon/favicon.ico">
  <script src="<?php echo __JS__;?>/jquery-2.1.4.min.js"></script>
  <script src="<?php echo __JS__;?>/nprogress.js"></script>
  <script src="<?php echo __JS__;?>/jquery.lazyload.min.js"></script>

  <!--the css for jquery.mCustomScrollbar-->
  <link rel="stylesheet" href="<?php echo __JS__;?>/jquery-emoji/lib/css/jquery.mCustomScrollbar.min.css"/>
  <!--the css for this plugin-->
  <link rel="stylesheet" href="<?php echo __JS__;?>/jquery-emoji/dist/css/jquery.emoji.css"/>

  <!--[if gte IE 9]>
  <script src="<?php echo __JS__;?>/jquery-1.11.1.min.js" type="text/javascript"></script>
  <script src="<?php echo __JS__;?>/html5shiv.min.js" type="text/javascript"></script>
  <script src="<?php echo __JS__;?>/respond.min.js" type="text/javascript"></script>
  <script src="<?php echo __JS__;?>/selectivizr-min.js" type="text/javascript"></script>
  <![endif]-->
  <!--[if lt IE 9]>
  <script>window.location.href='/index.php/home/index/ieBrowser';</script>
  <![endif]-->
  <style>
    .mcomlable{
      position: absolute;
      right: -2px;
      bottom: -2px;
      background: #3399CC;
      border: none;
      border: 2px solid;
      border-color: #3399CC;
      border-left: none;
      border-top: none;
      padding: 0px;
      width: 100px;
      height: 38px;
      color: #FFF;
      outline: 0;
      border-radius: 0 0 2px 0;
      font-size: 16px;
      z-index: 6;
    }
    .mcomlable:hover{
      background: #FBFBFB;
      border-color: #CCD4D9;
      color: #3399CC;
      border-top: solid 1px #F2F2F2;
    }
  </style>
</head>

<body class="user-select single">
<header class="header">
  <nav class="navbar navbar-default" id="navbar">
    <div class="container">
      <div class="header-topbar hidden-xs link-border">
        <ul class="site-nav topmenu">
          <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" rel="nofollow">关注本站 <span class="caret"></span></a>
            <ul class="dropdown-menu header-topbar-dropdown-menu">
              <li><a data-toggle="modal" data-target="#WeChat" rel="nofollow"><i class="fa fa-weixin"></i> 微信</a></li>
              <li><a data-toggle="modal" data-target="#areDeveloping" rel="nofollow"><i class="fa fa-rss"></i> RSS</a></li>
              <?php if($flag!='请登录'){ ?>
              <li><a href="/home/index/loginOut" >退出登录</a></li>
              <?php } ?>
            </ul>
          </li>
        </ul>
        <a data-toggle="modal" <?php if($flag=='请登录'){echo 'onclick="show()"';}?> class="login" rel="nofollow">Hi,<?php echo $flag?></a>&nbsp;&nbsp;
        <?php if($flag=='请登录'){ ?> <a href="/home/index/registerNew" >我要注册</a>&nbsp;&nbsp;
        <a href="/home/index/resetPsd" rel="nofollow">找回密码</a> <?php } ?></div>
      <!--blog图-->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#header-navbar" aria-expanded="false"> <span class="sr-only"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button>
        <h1 class="logo hvr-bounce-in"><a href="" title=""><img src="<?php echo __IMAGES__;?>/logo.png" alt=""></a></h1>
      </div>
      <div class="collapse navbar-collapse" id="header-navbar">
        <ul class="nav navbar-nav navbar-right">
          <li class="active"><a href="/home/index/list">LuLu的首页</a></li>
          <?php foreach($cat_res as $v){ ?>
          <li class="hidden-index">
            <a href="/home/index/category?cat_id=<?php echo $v['id']; ?>">
              <?php echo $v['cat_name']; ?></a>
          </li>
          <?php } ?>
        </ul>
        <form class="navbar-form visible-xs" action="/Search" method="post">
          <div class="input-group">
            <input type="text" name="keyword" class="form-control" placeholder="请输入关键字" maxlength="20" autocomplete="off">
            <span class="input-group-btn">
            <button class="btn btn-default btn-search" name="search" type="submit">搜索</button>
            </span> </div>
        </form>
      </div>
    </div>
  </nav>
</header>
<section class="container">
  <div class="content-wrap">
    <div class="content">
      <header class="article-header">
        <h1 class="article-title"><a href="article.html"><?php echo $art_info['title']; ?></a></h1>
        <div class="article-meta">
          <span class="item article-meta-time">
          <time class="time" data-toggle="tooltip" data-placement="bottom" title="时间：<?php echo $art_info['pub_time']; ?>">
            <i class="glyphicon glyphicon-time"></i> <?php echo $art_info['pub_time']; ?></time></span>
          <span class="item article-meta-category" data-toggle="tooltip" data-placement="bottom" title="栏目：<?php echo $art_info['cat_name']; ?>">
            <i class="glyphicon glyphicon-list"></i> <a href="program" title=""><?php echo $art_info['cat_name']; ?></a></span>
          <span class="item article-meta-views" data-toggle="tooltip" data-placement="bottom">
            <i class="glyphicon glyphicon-eye-open"></i> 共<?php echo mt_rand(1,200); ?>人围观</span>
          <span class="item article-meta-comment" data-toggle="tooltip" data-placement="bottom" title="评论：<?php echo $art_info['comm']; ?>">
            <i class="glyphicon glyphicon-comment"></i> <?php echo $art_info['comm']; ?>个评论</span>
        </div>
      </header>
      <article class="article-content">
        <p><img data-original="images/banner/banner_03.jpg" src="<?php echo __IMAGES__;?>/banner/banner_03.jpg" alt="" /></p>
        <pre>
          <?php echo $art_info['content']; ?>
        </pre>
        <p class="article-copyright hidden-xs">未经允许不得转载：<a href="">LuLu的BLOG</a> » <a href="article.html"><?php echo $art_info['title']; ?></a></p>
      </article>
      <div class="title" id="comment">
        <h3>评论</h3>
      </div>
      <?php if($flag=='请登录'){ ?>
      <div id="respond">
        <div class="comment-signarea">
          <h3 class="text-muted">评论前必须登录！</h3>
          <p> <a href="javascript:;" class="btn btn-primary login" rel="nofollow" onclick="show()">立即登录</a> &nbsp;
            <a href="/home/index/registerNew" class="btn btn-default register" rel="nofollow">注册</a> </p>
          <h3 class="text-muted">当前文章禁止评论</h3>
        </div>
      </div>
      <?php }else{ ?>
      <div id="respond">
        <div class="comment">
          <div class="comment-title"><img class="avatar" src="<?php echo __IMAGES__;?>/icon/icon.png" alt="" /></div>
          <div class="comment-box">
            <!--<div id="comment_text" contenteditable="true" style="height: 80px;"></div>-->
            <textarea placeholder="您的评论可以一针见血" name="comment_text" id="comment_text" cols="100%" rows="3" tabindex="1" style="border: 0px;"></textarea>
            <div class="comment-ctrl"> <span class="emotion">
              <div id="show_emoji"><img src="<?php echo __IMAGES__;?>/face/5.png" width="20" height="20" alt="" />表情</div></span>
              <div class="comment-prompt"> <i class="fa fa-spin fa-circle-o-notch"></i> <span class="comment-prompt-text"></span> </div>
              <input type="hidden" value="1" class="articleid" />
              <button class="mcomlable" onclick="sendComment()" tabindex="5" articleid="1">评论</button>
            </div>
          </div>
        </div>
      </div>
      <?php } ?>
      <input type="hidden" id="art_id" value="<?php echo $art_info['id']; ?>">
      <!--评论列表-->
      <div id="postcomments">
        <ol class="commentlist">
          <?php foreach($comm_info as $cv){ ?>
            <li class="comment-content">
            <div class="comment-avatar"><img class="avatar" src="<?php echo __IMAGES__;?>/icon/icon.png" alt="" /></div>
            <div class="comment-main">
              <p>来自<span class="address"><?php echo $cv['ip_address']; ?></span>的用户:<?php echo $cv['nick']; ?><span class="time">(<?php echo $cv['pub_time']; ?>)</span><br />
                <?php echo $cv['content']; ?></p>
            </div>
          </li>
          <?php } ?>
        </ol>
        <!--<div class="quotes"><span class="disabled">首页</span><span class="disabled">上一页</span><a class="current">1</a><a href="">2</a><span class="disabled">下一页</span><span class="disabled">尾页</span></div>-->
      </div>
    </div>
  </div>
  <aside class="sidebar">
    <div class="fixed">
      <div class="widget widget-tabs">
        <ul class="nav nav-tabs" role="tablist">
          <li role="presentation" class="active"><a href="#notice" aria-controls="notice" role="tab" data-toggle="tab">网站公告</a></li>
          <!--<li role="presentation"><a href="#centre" aria-controls="centre" role="tab" data-toggle="tab">会员中心</a></li>-->
          <li role="presentation"><a href="#contact" aria-controls="contact" role="tab" data-toggle="tab">联系站长</a></li>
        </ul>
        <div class="tab-content">
          <!--网站公告-->
          <div role="tabpanel" class="tab-pane notice active" id="notice">
            <ul>
              <li>
                <time datetime="2016-01-04"><?php echo date('m-d'); ?></time>
                <a href="" onclick="javascript:void(this)">LuLu最近比较懒，什么都没留下</a></li>
            </ul>
          </div>
          <!--会员中心-->
          <!--<div role="tabpanel" class="tab-pane centre" id="centre">-->
          <!--<h4>需要登录才能进入会员中心</h4>-->
          <!--<p> <a data-toggle="modal" data-target="#loginModal" class="btn btn-primary">立即登录</a> <a href="javascript:;" class="btn btn-default">现在注册</a> </p>-->
          <!--</div>-->
          <!--联系站长-->
          <div role="tabpanel" class="tab-pane contact" id="contact">
            <h2>Email:<br />
              <a href="mailto:admin@ylsat.com" data-toggle="tooltip" data-placement="bottom" title="990527551@qq.com">990527551@qq.com</a></h2>
          </div>
        </div>
      </div>
    </div>
    <!--每日一句-->
    <div class="widget widget_sentence">
      <h3>每日经典</h3>
      <div class="widget-sentence-content">
        <h4><?php $weekarray=array("日","一","二","三","四","五","六");echo date('Y年m月d日').'星期'.$weekarray[date("w")]; ?></h4>
        <p>Do not let what you cannot do interfere with what you can do.<br />
          别让你不能做的事妨碍到你能做的事。（John Wooden）</p>
      </div>
    </div>
    <!--热门文章-->
    <div class="widget widget_hot">
      <h3>栏目文章</h3>
      <ul>
        <?php foreach($article_res as $value){ ?>
        <li><a href="/home/index/article?art_id=<?php echo $value['id']; ?>"><?php echo $value['title']; ?><span class="thumbnail">
          <img class="thumb" data-original="<?php echo __UPLOADS__.'/'.$value['pic'];?>" alt="">
        </span><span class="text"></span><span class="muted">
          <i class="glyphicon glyphicon-time"></i> <?php echo $value['pub_time']; ?></span><span class="muted"><i class="glyphicon glyphicon-eye-open"></i> <?php echo mt_rand(1,200); ?></span></a></li>
        <?php }  ?>
      </ul>
    </div>
  </aside>
</section>
<footer class="footer">
  <div class="container">
    <p>&copy; 2019 <a href="">990527551@qq.com</a> &nbsp; </p>
  </div>
  <div id="gotop"><a class="gotop"></a></div>
</footer>
<!--微信二维码模态框-->
<div class="modal fade user-select" id="WeChat" tabindex="-1" role="dialog" aria-labelledby="WeChatModalLabel">
  <div class="modal-dialog" role="document" style="margin-top:120px;width:280px;">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="WeChatModalLabel" style="cursor:default;">微信扫一扫</h4>
      </div>
      <div class="modal-body" style="text-align:center"> <img src="<?php echo __IMAGES__;?>/weixin.jpg" alt="" style="cursor:pointer"/> </div>
    </div>
  </div>
</div>
<!--该功能正在日以继夜的开发中-->
<div class="modal fade user-select" id="areDeveloping" tabindex="-1" role="dialog" aria-labelledby="areDevelopingModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="areDevelopingModalLabel" style="cursor:default;">该功能正在日以继夜的开发中…</h4>
      </div>
      <div class="modal-body"> <img src="<?php echo __IMAGES__;?>/baoman/baoman_01.gif" alt="深思熟虑" />
        <p style="padding:15px 15px 15px 100px; position:absolute; top:15px; cursor:default;">很抱歉，程序猿正在日以继夜的开发此功能，本程序将会在以后的版本中持续完善！</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">朕已阅</button>
      </div>
    </div>
  </div>
</div>
<!--登录注册模态框-->
<div class="modal fade user-select" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="loginModalLabel" >
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <form method="post">
        <div class="modal-header">
          <button type="button" class="close" onclick="gb_close()"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="loginModalLabel">登录</h4>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="loginModalUserNmae">用户名</label>
            <input type="text" class="form-control" id="username" placeholder="请输入用户名" autofocus maxlength="15" autocomplete="off" >
          </div>
          <div class="form-group">
            <label for="loginModalUserPwd">密码</label>
            <input type="password" class="form-control" id="password" placeholder="请输入密码" maxlength="18" autocomplete="off" >
          </div>
          <div class="form-group">
            <label for="loginModalUserPwd" style="display: block;">验证码</label>
            <input type="text" class="form-control" id="verify_code" placeholder="请输入密码" maxlength="18" autocomplete="off" style="width: 150px;float: left;">
            <img id="img" src="/home/index/vCode" alt="验证码" width="90" height="36" style="display: inline-block;float: left;margin-left: 15px;" onclick="new_verify(this)">
          </div>
        </div>
        <div class="modal-footer" style="margin-top: 33px">
          <button type="button" class="btn btn-default" onclick="gb_close()">取消</button>
          <label class="btn btn-primary" onclick="login()">登录</label>
        </div>
      </form>
    </div>
  </div>
</div>
<!--模态框-->
<div id="bg" style="display: none;position: fixed;top: 0;left: 0; width: 100%;height: 100%;background-color: black;z-index:1001;-moz-opacity: 0.3;opacity:.30;filter: alpha(opacity=30);"></div>
<!--右键菜单列表-->
<div id="rightClickMenu">
  <ul class="list-group rightClickMenuList">
    <li class="list-group-item disabled">欢迎访问LuLu的BLOG</li>
    <li class="list-group-item"><span>IP：</span><?php echo getIp(); ?></li>
    <li class="list-group-item"><span>地址：</span><?php echo getIpAddress(); ?></li>
    <li class="list-group-item"><span>系统：</span><?php echo php_uname('s'); ?> </li>
    <!--<li class="list-group-item"><span>浏览器：</span>Chrome47</li>-->
  </ul>
</div>
<script src="<?php echo __JS__;?>/bootstrap.min.js"></script>
<script src="<?php echo __JS__;?>/scripts.js"></script>
<script src="<?php echo __ALIB__;?>/layui/layui.js" charset="utf-8"></script>
<script type="text/javascript" src="<?php echo __AJS__;?>/xadmin.js"></script>

<!--the js for jquery-->
<!--<script src="http://cdn.bootcss.com/jquery/1.11.3/jquery.js"></script>-->
<!--(Optional) the js for jquery.mCustomScrollbar's addon-->
<script src="<?php echo __JS__;?>/jquery-emoji/lib/script/jquery.mousewheel-3.0.6.min.js"></script>
<!--the js for jquery.mCustomScrollbar-->
<script src="<?php echo __JS__;?>/jquery-emoji/lib/script/jquery.mCustomScrollbar.min.js"></script>
<!--the js for this plugin-->
<script src="<?php echo __JS__;?>/jquery-emoji/src/js/jquery.emoji.js"></script>
<script>
    init_emoji();
    //登录
    function login() {
        var username = $("#username").val();
        var password = $("#password").val();
        var verify_code = $("#verify_code").val();
        if (check(username,password,verify_code)) {
            $.post('/home/index/login', {
                username: username,
                password: password,
                verify_code: verify_code
            }, function (res) {
                if (res.code == 500) {
                    layer.alert(res.data, {
                        icon: 5
                    });
                    $("#img").attr("src",'/home/index/vCode?nowtime='+new Date().getTime())
                } else {
                    layer.msg(res.data, {icon: 1, time: 1000});
                    window.setTimeout("gb_close()",1000);
                    window.setTimeout("window.location.href = self.location.href",1000);
                }
            }, 'json');
        }else{
            return false;
        }
    }

    //模态框开启
    function show() {
        $('#bg').show();
        $("#loginModal").removeClass("modal fade user-select");
        $("#loginModal").addClass("modal fade user-select in");
        $('#loginModal').attr('style','display:block');
    }

    //模态框关闭
    function gb_close() {
        $('#bg').hide();
        $("#loginModal").removeClass("modal fade user-select in");
        $("#loginModal").addClass("modal fade user-select");
        $('#loginModal').attr('style','display:none');
    }

    //刷新验证码
    function new_verify(obj) {
        obj.src='/home/index/vCode?nowtime='+new Date().getTime();
    }

    function check(username,password,verify_code) {
        if (username.length<1) {
            layer.msg('请输入用户名');
            return false;
        }
        if (password.length<1){
            layer.msg('请输入密码');
            return false;
        }
        if (verify_code.length<1){
            layer.alert('请输入验证码', {
                icon: 5
            });
            return false;
        }
        return true;
    }

    //表情初始化<?php echo __JS__;?>/jquery-emoji/dist/img
    function init_emoji() {
        //绑定可编辑div
        $("#comment_text").emoji({
            //绑定按钮
            button: "#show_emoji",
            showTab: false,
            animation: 'slide',
            icons: [{
                name: "QQ表情",
                path: "<?php echo __JS__;?>/jquery-emoji/dist/img/qq/",
                maxNum: 91,
                excludeNums: [41, 45, 54],
                file: ".gif",
                placeholder: "#emoji:{alias}_img#"
            }]
        });
    }

    //发送评论
    function sendComment() {
        var content =  $("#comment_text").val(); //内容
        var art_id = $("#art_id").val();
        $.post('/home/index/sendComm', {
            content: content,
            art_id: art_id
        }, function (res) {
            if (res.code == 500) {
                layer.alert(res.data, {
                    icon: 5
                });
            } else {
                layer.alert(res.data, {
                    icon: 6
                });
                $("#comment_text").val('');
                //拉取评论
                $.post('/home/index/getComm', {
                    art_id: art_id
                }, function (res) {
                    if (res.code == 500) {
                        layer.alert(res.data, {
                            icon: 5
                        });
                        window.location.href = self.location.href;
                    } else {
                        //ajax评论
                        $("#postcomments").empty();
                        var comm_str = comm_node(res.data);
                        $("#postcomments").append(comm_str);
                    }
                }, 'json');
            }
        }, 'json');
    }

    //组装ajax评论刷新
    function comm_node(arr) {
        var len = arr.length;
        var str_com = '<ol class="commentlist">';
            for (var i=0;i<len;i++) {
                str_com += '<li class="comment-content">' +
                    '<div class="comment-avatar"><img class="avatar" src="<?php echo __IMAGES__;?>/icon/icon.png" alt="" /></div>' +
                    '<div class="comment-main">' +
                    '<p>来自<span class="address">' + arr[i].ip_address + '</span>的用户:' + arr[i].nick + '<span class="time">(' + arr[i].pub_time + ')</span><br />' +
                    arr[i].content + '</p>' +
                    '</div>' +
                    '</li>';
            }
            str_com +='</ol>';
        console.log(str_com);
        return str_com;
    }

</script>
</body>
</html>